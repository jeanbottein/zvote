var Kr=Object.defineProperty;var Wt=e=>{throw TypeError(e)};var Jr=(e,t,r)=>t in e?Kr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var f=(e,t,r)=>Jr(e,typeof t!="symbol"?t+"":t,r),st=(e,t,r)=>t.has(e)||Wt("Cannot "+r);var a=(e,t,r)=>(st(e,t,"read from private field"),r?r.call(e):t.get(e)),_=(e,t,r)=>t.has(e)?Wt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),h=(e,t,r,n)=>(st(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),d=(e,t,r)=>(st(e,t,"access private method"),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();const yr="utf-8";function w(e,t=void 0){if(e)throw TypeError("Decoder error");return t||65533}function G(e){throw TypeError("The code point "+e+" could not be encoded.")}function ut(e){const t=String(e).trim().toLowerCase();return t in pt?pt[t]:null}const Tr=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"ISO-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"ISO-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"ISO-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"ISO-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"ISO-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"ISO-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-I"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","cp1252","cp819","ibm819","iso-ir-100","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["ascii","us-ascii","iso-8859-1","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","csisolatin1"],name:"iso-8859-1"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:["csshiftjis","ms932","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"Shift_JIS"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],pt={};Tr.forEach(e=>{e.encodings.forEach(t=>{t.labels.forEach(r=>{pt[r]=t})})});const U=-1;function br(e){return Array.isArray(e)?e:[e]}function b(e,t,r){return t<=e&&e<=r}function Hr(e,t){return e.indexOf(t)!==-1}function $e(e){if(e==null)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function Gr(e){const t=String(e),r=t.length;let n=0;const i=[];for(;n<r;){const s=t.charCodeAt(n);if(s<55296||s>57343)i.push(s);else if(56320<=s&&s<=57343)i.push(65533);else if(55296<=s&&s<=56319)if(n===r-1)i.push(65533);else{const c=t.charCodeAt(n+1);if(56320<=c&&c<=57343){const p=s&1023,T=c&1023;i.push(65536+(p<<10)+T),n+=1}else i.push(65533)}n+=1}return i}function Wr(e){let t="";for(let r=0;r<e.length;++r){let n=e[r];n<=65535?t+=String.fromCharCode(n):(n-=65536,t+=String.fromCharCode((n>>10)+55296,(n&1023)+56320))}return t}function mr(){if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}let at;function Zr(){if(typeof TextEncodingIndexes<"u")return TextEncodingIndexes.encodingIndexes;const e=mr();return e?"TextEncodingIndexes"in e?global.TextEncodingIndexes.encodingIndexes:"encoding-indexes"in e?global.encodingIndexes:null:null}function _r(){if(at)return at;const e=Zr();return e?(at=e,e):null}function Ie(e,t){return t&&t[e]||null}function Ae(e,t){const r=t.indexOf(e);return r===-1?null:r}function L(e){const t=_r();if(!t)throw Error("Indexes missing. Did you forget to include encoding-indexes.js first?");return t[e]}function Xr(e){if(e>39419&&e<189e3||e>1237575)return null;if(e===7457)return 59335;let t=0,r=0;const n=L("gb18030-ranges");for(let i=0;i<n.length;++i){const s=br(n[i]);if(s[0]<=e)t=s[0],r=s[1];else break}return r+e-t}function Yr(e){if(e===59335)return 7457;let t=0,r=0;const n=L("gb18030-ranges");for(let i=0;i<n.length;++i){const s=n[i],c=br(s);if(c[1]<=e)t=c[1],r=c[0];else break}return r+e-t}function Qr(e){return ot=ot||L("jis0208").map(function(r,n){return b(n,8272,8835)?null:r}),ot.indexOf(e)}let ot;function ei(e){ct=ct||L("big5").map((r,n)=>n<32*157?null:r);const t=ct;return e===9552||e===9566||e===9569||e===9578||e===21313||e===21317?t.lastIndexOf(e):Ae(e,t)}let ct;function J(e){return 0<=e&&e<=127}const K=J,x=-1;class ti{constructor(t){this.fatal=t.fatal,this.Big5_lead=0}handler(t,r){if(r===x&&this.Big5_lead!==0)return this.Big5_lead=0,w(this.fatal);if(r===x&&this.Big5_lead===0)return U;if(this.Big5_lead!==0){const n=this.Big5_lead;let i=null;this.Big5_lead=0;const s=r<127?64:98;switch((b(r,64,126)||b(r,161,254))&&(i=(n-129)*157+(r-s)),i){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}const c=i===null?null:Ie(i,L("big5"));return c===null&&J(r)&&t.prepend(r),c===null?w(this.fatal):c}return J(r)?r:b(r,129,254)?(this.Big5_lead=r,null):w(this.fatal)}}class ri{constructor(t){this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;const n=ei(r);if(n===null)return G(r);const i=Math.floor(n/157)+129;if(i<161)return G(r);const s=n%157,c=s<63?64:98;return[i,s+c]}}class ii{constructor(t){this.fatal=t.fatal,this.eucjp_jis0212_flag=!1,this.eucjp_lead=0}handler(t,r){if(r===x&&this.eucjp_lead!==0)return this.eucjp_lead=0,w(this.fatal);if(r===x&&this.eucjp_lead===0)return U;if(this.eucjp_lead===142&&b(r,161,223))return this.eucjp_lead=0,65216+r;if(this.eucjp_lead===143&&b(r,161,254))return this.eucjp_jis0212_flag=!0,this.eucjp_lead=r,null;if(this.eucjp_lead!==0){const n=this.eucjp_lead;this.eucjp_lead=0;let i=null;return b(n,161,254)&&b(r,161,254)&&(i=Ie((n-161)*94+(r-161),L(this.eucjp_jis0212_flag?"jis0212":"jis0208"))),this.eucjp_jis0212_flag=!1,b(r,161,254)||t.prepend(r),i===null?w(this.fatal):i}return J(r)?r:r===142||r===143||b(r,161,254)?(this.eucjp_lead=r,null):w(this.fatal)}}class ni{constructor(t){this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;if(r===165)return 92;if(r===8254)return 126;if(b(r,65377,65439))return[142,r-65377+161];r===8722&&(r=65293);const n=Ae(r,L("jis0208"));if(n===null)return G(r);const i=Math.floor(n/94)+161,s=n%94+161;return[i,s]}}class si{constructor(t){this.fatal=t.fatal,this.euckr_lead=0}handler(t,r){if(r===x&&this.euckr_lead!==0)return this.euckr_lead=0,w(this.fatal);if(r===x&&this.euckr_lead===0)return U;if(this.euckr_lead!==0){const n=this.euckr_lead;let i=null;this.euckr_lead=0,b(r,65,254)&&(i=(n-129)*190+(r-65));const s=i===null?null:Ie(i,L("euc-kr"));return i===null&&J(r)&&t.prepend(r),s===null?w(this.fatal):s}return J(r)?r:b(r,129,254)?(this.euckr_lead=r,null):w(this.fatal)}}class ai{constructor(t){this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;const n=Ae(r,L("euc-kr"));if(n===null)return G(r);const i=Math.floor(n/190)+129,s=n%190+65;return[i,s]}}class Zt{constructor(t){this.fatal=t.fatal,this.gb18030_first=0,this.gb18030_second=0,this.gb18030_third=0}handler(t,r){if(r===x&&this.gb18030_first===0&&this.gb18030_second===0&&this.gb18030_third===0)return U;r===x&&(this.gb18030_first!==0||this.gb18030_second!==0||this.gb18030_third!==0)&&(this.gb18030_first=0,this.gb18030_second=0,this.gb18030_third=0,w(this.fatal));let n;if(this.gb18030_third!==0){n=null,b(r,48,57)&&(n=Xr((((this.gb18030_first-129)*10+this.gb18030_second-48)*126+this.gb18030_third-129)*10+r-48));const i=[this.gb18030_second,this.gb18030_third,r];return this.gb18030_first=0,this.gb18030_second=0,this.gb18030_third=0,n===null?(t.prepend(i),w(this.fatal)):n}if(this.gb18030_second!==0)return b(r,129,254)?(this.gb18030_third=r,null):(t.prepend([this.gb18030_second,r]),this.gb18030_first=0,this.gb18030_second=0,w(this.fatal));if(this.gb18030_first!==0){if(b(r,48,57))return this.gb18030_second=r,null;const i=this.gb18030_first;let s=null;this.gb18030_first=0;const c=r<127?64:65;return(b(r,64,126)||b(r,128,254))&&(s=(i-129)*190+(r-c)),n=s===null?null:Ie(s,L("gb18030")),n===null&&J(r)&&t.prepend(r),n===null?w(this.fatal):n}return J(r)?r:r===128?8364:b(r,129,254)?(this.gb18030_first=r,null):w(this.fatal)}}class Xt{constructor(t,r=void 0){this.gbk_flag=r,this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;if(r===58853)return G(r);if(this.gbk_flag&&r===8364)return 128;let n=Ae(r,L("gb18030"));if(n!==null){const T=Math.floor(n/190)+129,m=n%190,I=m<63?64:65;return[T,m+I]}if(this.gbk_flag)return G(r);n=Yr(r);const i=Math.floor(n/10/126/10);n=n-i*10*126*10;const s=Math.floor(n/10/126);n=n-s*10*126;const c=Math.floor(n/10),p=n-c*10;return[i+129,s+48,c+129,p+48]}}var E;(function(e){e[e.ASCII=0]="ASCII",e[e.Roman=1]="Roman",e[e.Katakana=2]="Katakana",e[e.LeadByte=3]="LeadByte",e[e.TrailByte=4]="TrailByte",e[e.EscapeStart=5]="EscapeStart",e[e.Escape=6]="Escape"})(E||(E={}));class oi{constructor(t){this.fatal=t.fatal,this.iso2022jp_decoder_state=E.ASCII,this.iso2022jp_decoder_output_state=E.ASCII,this.iso2022jp_lead=0,this.iso2022jp_output_flag=!1}handler(t,r){switch(this.iso2022jp_decoder_state){default:case E.ASCII:return r===27?(this.iso2022jp_decoder_state=E.EscapeStart,null):b(r,0,127)&&r!==14&&r!==15&&r!==27?(this.iso2022jp_output_flag=!1,r):r===x?U:(this.iso2022jp_output_flag=!1,w(this.fatal));case E.Roman:return r===27?(this.iso2022jp_decoder_state=E.EscapeStart,null):r===92?(this.iso2022jp_output_flag=!1,165):r===126?(this.iso2022jp_output_flag=!1,8254):b(r,0,127)&&r!==14&&r!==15&&r!==27&&r!==92&&r!==126?(this.iso2022jp_output_flag=!1,r):r===x?U:(this.iso2022jp_output_flag=!1,w(this.fatal));case E.Katakana:return r===27?(this.iso2022jp_decoder_state=E.EscapeStart,null):b(r,33,95)?(this.iso2022jp_output_flag=!1,65344+r):r===x?U:(this.iso2022jp_output_flag=!1,w(this.fatal));case E.LeadByte:return r===27?(this.iso2022jp_decoder_state=E.EscapeStart,null):b(r,33,126)?(this.iso2022jp_output_flag=!1,this.iso2022jp_lead=r,this.iso2022jp_decoder_state=E.TrailByte,null):r===x?U:(this.iso2022jp_output_flag=!1,w(this.fatal));case E.TrailByte:if(r===27)return this.iso2022jp_decoder_state=E.EscapeStart,w(this.fatal);if(b(r,33,126)){this.iso2022jp_decoder_state=E.LeadByte;const s=(this.iso2022jp_lead-33)*94+r-33,c=Ie(s,L("jis0208"));return c===null?w(this.fatal):c}return r===x?(this.iso2022jp_decoder_state=E.LeadByte,t.prepend(r),w(this.fatal)):(this.iso2022jp_decoder_state=E.LeadByte,w(this.fatal));case E.EscapeStart:return r===36||r===40?(this.iso2022jp_lead=r,this.iso2022jp_decoder_state=E.Escape,null):(t.prepend(r),this.iso2022jp_output_flag=!1,this.iso2022jp_decoder_state=this.iso2022jp_decoder_output_state,w(this.fatal));case E.Escape:const n=this.iso2022jp_lead;this.iso2022jp_lead=0;let i=null;if(n===40&&r===66&&(i=E.ASCII),n===40&&r===74&&(i=E.Roman),n===40&&r===73&&(i=E.Katakana),n===36&&(r===64||r===66)&&(i=E.LeadByte),i!==null){this.iso2022jp_decoder_state=this.iso2022jp_decoder_state=i;const s=this.iso2022jp_output_flag;return this.iso2022jp_output_flag=!0,s?w(this.fatal):null}return t.prepend([n,r]),this.iso2022jp_output_flag=!1,this.iso2022jp_decoder_state=this.iso2022jp_decoder_output_state,w(this.fatal)}}}var N;(function(e){e[e.ASCII=0]="ASCII",e[e.Roman=1]="Roman",e[e.jis0208=2]="jis0208"})(N||(N={}));class ci{constructor(t){this.fatal=t.fatal,this.iso2022jp_state=N.ASCII}handler(t,r){if(r===x&&this.iso2022jp_state!==N.ASCII)return t.prepend(r),this.iso2022jp_state=N.ASCII,[27,40,66];if(r===x&&this.iso2022jp_state===N.ASCII)return U;if((this.iso2022jp_state===N.ASCII||this.iso2022jp_state===N.Roman)&&(r===14||r===15||r===27))return G(65533);if(this.iso2022jp_state===N.ASCII&&K(r))return r;if(this.iso2022jp_state===N.Roman&&(K(r)&&r!==92&&r!==126||r==165||r==8254)){if(K(r))return r;if(r===165)return 92;if(r===8254)return 126}if(K(r)&&this.iso2022jp_state!==N.ASCII)return t.prepend(r),this.iso2022jp_state=N.ASCII,[27,40,66];if((r===165||r===8254)&&this.iso2022jp_state!==N.Roman)return t.prepend(r),this.iso2022jp_state=N.Roman,[27,40,74];r===8722&&(r=65293);const n=Ae(r,L("jis0208"));if(n===null)return G(r);if(this.iso2022jp_state!==N.jis0208)return t.prepend(r),this.iso2022jp_state=N.jis0208,[27,36,66];const i=Math.floor(n/94)+33,s=n%94+33;return[i,s]}}class li{constructor(t){this.fatal=t.fatal,this.Shift_JIS_lead=0}handler(t,r){if(r===x&&this.Shift_JIS_lead!==0)return this.Shift_JIS_lead=0,w(this.fatal);if(r===x&&this.Shift_JIS_lead===0)return U;if(this.Shift_JIS_lead!==0){const n=this.Shift_JIS_lead;let i=null;this.Shift_JIS_lead=0;const s=r<127?64:65,c=n<160?129:193;if((b(r,64,126)||b(r,128,252))&&(i=(n-c)*188+r-s),b(i,8836,10715))return 48508+i;const p=i===null?null:Ie(i,L("jis0208"));return p===null&&J(r)&&t.prepend(r),p===null?w(this.fatal):p}return J(r)||r===128?r:b(r,161,223)?65216+r:b(r,129,159)||b(r,224,252)?(this.Shift_JIS_lead=r,null):w(this.fatal)}}class ui{constructor(t){this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r)||r===128)return r;if(r===165)return 92;if(r===8254)return 126;if(b(r,65377,65439))return r-65377+161;r===8722&&(r=65293);const n=Qr(r);if(n===null)return G(r);const i=Math.floor(n/188),s=i<31?129:193,c=n%188,p=c<63?64:65;return[i+s,c+p]}}class pi{constructor(t,r){this.index=t,this.fatal=r.fatal}handler(t,r){if(r===x)return U;if(J(r))return r;const n=this.index[r-128];return n||w(this.fatal)}}class hi{constructor(t,r){this.index=t,this.fatal=r.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;const n=Ae(r,this.index);return n===null&&G(r),n+128}}function je(e,t){const r=e>>8,n=e&255;return t?[r,n]:[n,r]}class Yt{constructor(t,r){this.utf16_be=t,this.fatal=r.fatal,this.utf16_lead_byte=null,this.utf16_lead_surrogate=null}handler(t,r){if(r===x&&(this.utf16_lead_byte!==null||this.utf16_lead_surrogate!==null))return w(this.fatal);if(r===x&&this.utf16_lead_byte===null&&this.utf16_lead_surrogate===null)return U;if(this.utf16_lead_byte===null)return this.utf16_lead_byte=r,null;let n;if(this.utf16_be?n=(this.utf16_lead_byte<<8)+r:n=(r<<8)+this.utf16_lead_byte,this.utf16_lead_byte=null,this.utf16_lead_surrogate!==null){const i=this.utf16_lead_surrogate;return this.utf16_lead_surrogate=null,b(n,56320,57343)?65536+(i-55296)*1024+(n-56320):(t.prepend(je(n,this.utf16_be)),w(this.fatal))}return b(n,55296,56319)?(this.utf16_lead_surrogate=n,null):b(n,56320,57343)?w(this.fatal):n}}class Qt{constructor(t,r){this.utf16_be=t,this.fatal=r.fatal}handler(t,r){if(r===x)return U;if(b(r,0,65535))return je(r,this.utf16_be);const n=je((r-65536>>10)+55296,this.utf16_be),i=je((r-65536&1023)+56320,this.utf16_be);return n.concat(i)}}class di{constructor(t){this.fatal=t.fatal,this.utf8_code_point=0,this.utf8_bytes_seen=0,this.utf8_bytes_needed=0,this.utf8_lower_boundary=128,this.utf8_upper_boundary=191}handler(t,r){if(r===x&&this.utf8_bytes_needed!==0)return this.utf8_bytes_needed=0,w(this.fatal);if(r===x)return U;if(this.utf8_bytes_needed===0){if(b(r,0,127))return r;if(b(r,194,223))this.utf8_bytes_needed=1,this.utf8_code_point=r&31;else if(b(r,224,239))r===224&&(this.utf8_lower_boundary=160),r===237&&(this.utf8_upper_boundary=159),this.utf8_bytes_needed=2,this.utf8_code_point=r&15;else if(b(r,240,244))r===240&&(this.utf8_lower_boundary=144),r===244&&(this.utf8_upper_boundary=143),this.utf8_bytes_needed=3,this.utf8_code_point=r&7;else return w(this.fatal);return null}if(!b(r,this.utf8_lower_boundary,this.utf8_upper_boundary))return this.utf8_code_point=this.utf8_bytes_needed=this.utf8_bytes_seen=0,this.utf8_lower_boundary=128,this.utf8_upper_boundary=191,t.prepend(r),w(this.fatal);if(this.utf8_lower_boundary=128,this.utf8_upper_boundary=191,this.utf8_code_point=this.utf8_code_point<<6|r&63,this.utf8_bytes_seen+=1,this.utf8_bytes_seen!==this.utf8_bytes_needed)return null;const n=this.utf8_code_point;return this.utf8_code_point=this.utf8_bytes_needed=this.utf8_bytes_seen=0,n}}class fi{constructor(t){this.fatal=t.fatal}handler(t,r){if(r===x)return U;if(K(r))return r;let n,i;b(r,128,2047)?(n=1,i=192):b(r,2048,65535)?(n=2,i=224):b(r,65536,1114111)&&(n=3,i=240);const s=[(r>>6*n)+i];for(;n>0;){const c=r>>6*(n-1);s.push(128|c&63),n-=1}return s}}class gi{constructor(t){this.fatal=t.fatal}handler(t,r){return r===x?U:J(r)?r:63360+r-128}}class yi{constructor(t){this.fatal=t.fatal}handler(t,r){return r===x?U:K(r)?r:b(r,63360,63487)?r-63360+128:G(r)}}const Ti=_r(),ht={"UTF-8":e=>new fi(e),GBK:e=>new Xt(e,!0),gb18030:e=>new Xt(e),Big5:e=>new ri(e),"EUC-JP":e=>new ni(e),"ISO-2022-JP":e=>new ci(e),Shift_JIS:e=>new ui(e),"EUC-KR":e=>new ai(e),"UTF-16BE":e=>new Qt(!0,e),"UTF-16LE":e=>new Qt(!1,e),"x-user-defined":e=>new yi(e)},dt={"UTF-8":e=>new di(e),GBK:e=>new Zt(e),gb18030:e=>new Zt(e),Big5:e=>new ti(e),"EUC-JP":e=>new ii(e),"ISO-2022-JP":e=>new oi(e),Shift_JIS:e=>new li(e),"EUC-KR":e=>new si(e),"UTF-16BE":e=>new Yt(!0,e),"UTF-16LE":e=>new Yt(!1,e),"x-user-defined":e=>new gi(e)};Ti&&Tr.forEach(function(e){e.heading==="Legacy single-byte encodings"&&e.encodings.forEach(function(t){const r=t.name,n=L(r.toLowerCase());dt[r]=function(i){return new pi(n,i)},ht[r]=function(i){return new hi(n,i)}})});class wr{constructor(t){this.tokens=Array.from(t),this.tokens.reverse()}endOfStream(){return!this.tokens.length}read(){return this.tokens.length?this.tokens.pop():x}prepend(t){if(Array.isArray(t)){const r=t;for(;r.length;)this.tokens.push(r.pop())}else this.tokens.push(t)}push(t){if(Array.isArray(t)){const r=t;for(;r.length;)this.tokens.unshift(r.shift())}else this.tokens.unshift(t)}}class xr{constructor(t,r){t=t!==void 0?String(t):yr;const n=$e(r);this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;const i=ut(t);if(i===null||i.name==="replacement")throw RangeError("Unknown encoding: "+t);if(!dt[i.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?");this._encoding=i,n.fatal&&(this._error_mode="fatal"),n.ignoreBOM&&(this._ignoreBOM=!0)}get encoding(){return this._encoding.name.toLowerCase()}get fatal(){return this._error_mode==="fatal"}get ignoreBOM(){return this._ignoreBOM}decode(t,r){const n=bi(t),i=$e(r);this._do_not_flush||(this._decoder=dt[this._encoding.name]({fatal:this._error_mode==="fatal"}),this._BOMseen=!1),this._do_not_flush=!!i.stream;const s=new wr(n),c=[];let p;for(;;){const T=s.read();if(T===x||(p=this._decoder.handler(s,T),p===U))break;p!==null&&(Array.isArray(p)?c.push.apply(c,p):c.push(p))}if(!this._do_not_flush){do{if(p=this._decoder.handler(s,s.read()),p===U)break;p&&(Array.isArray(p)?c.push.apply(c,p):c.push(p))}while(!s.endOfStream());this._decoder=null}return this.serializeStream(c)}serializeStream(t){return Hr(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)&&!this._ignoreBOM&&!this._BOMseen&&(t.length>0&&t[0]===65279?(this._BOMseen=!0,t.shift()):t.length>0&&(this._BOMseen=!0)),Wr(t)}}function er(e){try{return e instanceof ArrayBuffer}catch(t){return console.error(t),!1}}function bi(e){return typeof e!="object"?new Uint8Array(0):er(e)?new Uint8Array(e):"buffer"in e&&er(e.buffer)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0)}class Sr{constructor(t,r){const n=$e(r);if(this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=n.fatal?"fatal":"replacement",n.NONSTANDARD_allowLegacyEncoding){t=t?String(t):yr;const i=ut(t);if(i===null||i.name==="replacement")throw RangeError("Unknown encoding: "+t);if(!ht[i.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");this._encoding=i}else{this._encoding=ut("utf-8");const i=mr()||{};t!==void 0&&"console"in i&&console.warn("TextEncoder constructor called with encoding label, which is ignored.")}}get encoding(){return this._encoding.name.toLowerCase()}encode(t,r){t=t===void 0?"":String(t);const n=$e(r);this._do_not_flush||(this._encoder=ht[this._encoding.name]({fatal:this._fatal==="fatal"})),this._do_not_flush=!!n.stream;const i=new wr(Gr(t)),s=[];let c;for(;;){const p=i.read();if(p===x||(c=this._encoder.handler(i,p),c===U))break;Array.isArray(c)?s.push.apply(s,c):s.push(c)}if(!this._do_not_flush){for(;c=this._encoder.handler(i,i.read()),c!==U;)Array.isArray(c)?s.push.apply(s,c):s.push(c);this._encoder=null}return new Uint8Array(s)}}if(typeof window<"u"){const e=t=>!(t in window)||typeof window[t]>"u"||window[t]===null;e("TextDecoder")&&(window.TextDecoder=xr),e("TextEncoder")&&(window.TextEncoder=Sr)}var Ir=xi,Z=[],tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Oe=0,mi=tr.length;Oe<mi;++Oe)Z[Oe]=tr[Oe];function _i(e){return Z[e>>18&63]+Z[e>>12&63]+Z[e>>6&63]+Z[e&63]}function wi(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(_i(n));return i.join("")}function xi(e){for(var t,r=e.length,n=r%3,i=[],s=16383,c=0,p=r-n;c<p;c+=s)i.push(wi(e,c,c+s>p?p:c+s));return n===1?(t=e[r-1],i.push(Z[t>>2]+Z[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],i.push(Z[t>>10]+Z[t>>4&63]+Z[t<<2&63]+"=")),i.join("")}var S,g,or,ye=(or=class{constructor(e){_(this,S);_(this,g,0);h(this,S,new DataView(e.buffer)),h(this,g,e.byteOffset)}get offset(){return a(this,g)}readUInt8Array(){const e=this.readU32(),t=new Uint8Array(a(this,S).buffer,a(this,g),e);return h(this,g,a(this,g)+e),t}readBool(){const e=a(this,S).getUint8(a(this,g));return h(this,g,a(this,g)+1),e!==0}readByte(){const e=a(this,S).getUint8(a(this,g));return h(this,g,a(this,g)+1),e}readBytes(e){const t=new DataView(a(this,S).buffer,a(this,g),e);return h(this,g,a(this,g)+e),new Uint8Array(t.buffer)}readI8(){const e=a(this,S).getInt8(a(this,g));return h(this,g,a(this,g)+1),e}readU8(){const e=a(this,S).getUint8(a(this,g));return h(this,g,a(this,g)+1),e}readI16(){const e=a(this,S).getInt16(a(this,g),!0);return h(this,g,a(this,g)+2),e}readU16(){const e=a(this,S).getUint16(a(this,g),!0);return h(this,g,a(this,g)+2),e}readI32(){const e=a(this,S).getInt32(a(this,g),!0);return h(this,g,a(this,g)+4),e}readU32(){const e=a(this,S).getUint32(a(this,g),!0);return h(this,g,a(this,g)+4),e}readI64(){const e=a(this,S).getBigInt64(a(this,g),!0);return h(this,g,a(this,g)+8),e}readU64(){const e=a(this,S).getBigUint64(a(this,g),!0);return h(this,g,a(this,g)+8),e}readU128(){const e=a(this,S).getBigUint64(a(this,g),!0),t=a(this,S).getBigUint64(a(this,g)+8,!0);return h(this,g,a(this,g)+16),(t<<BigInt(64))+e}readI128(){const e=a(this,S).getBigUint64(a(this,g),!0),t=a(this,S).getBigInt64(a(this,g)+8,!0);return h(this,g,a(this,g)+16),(t<<BigInt(64))+e}readU256(){const e=a(this,S).getBigUint64(a(this,g),!0),t=a(this,S).getBigUint64(a(this,g)+8,!0),r=a(this,S).getBigUint64(a(this,g)+16,!0),n=a(this,S).getBigUint64(a(this,g)+24,!0);return h(this,g,a(this,g)+32),(n<<BigInt(3*64))+(r<<BigInt(2*64))+(t<<BigInt(1*64))+e}readI256(){const e=a(this,S).getBigUint64(a(this,g),!0),t=a(this,S).getBigUint64(a(this,g)+8,!0),r=a(this,S).getBigUint64(a(this,g)+16,!0),n=a(this,S).getBigInt64(a(this,g)+24,!0);return h(this,g,a(this,g)+32),(n<<BigInt(3*64))+(r<<BigInt(2*64))+(t<<BigInt(1*64))+e}readF32(){const e=a(this,S).getFloat32(a(this,g),!0);return h(this,g,a(this,g)+4),e}readF64(){const e=a(this,S).getFloat64(a(this,g),!0);return h(this,g,a(this,g)+8),e}readString(){const e=this.readU32(),t=new Uint8Array(a(this,S).buffer,a(this,g),e),n=new xr("utf-8").decode(t);return h(this,g,a(this,g)+e),n}},S=new WeakMap,g=new WeakMap,or),$,A,y,k,O,cr,X=(cr=class{constructor(e){_(this,k);_(this,$);_(this,A);_(this,y,0);h(this,$,new Uint8Array(e)),h(this,A,new DataView(a(this,$).buffer))}toBase64(){return Ir(a(this,$).subarray(0,a(this,y)))}getBuffer(){return a(this,$).slice(0,a(this,y))}writeUInt8Array(e){const t=e.length;d(this,k,O).call(this,4+t),this.writeU32(t),a(this,$).set(e,a(this,y)),h(this,y,a(this,y)+e.length)}writeBool(e){d(this,k,O).call(this,1),a(this,A).setUint8(a(this,y),e?1:0),h(this,y,a(this,y)+1)}writeByte(e){d(this,k,O).call(this,1),a(this,A).setUint8(a(this,y),e),h(this,y,a(this,y)+1)}writeI8(e){d(this,k,O).call(this,1),a(this,A).setInt8(a(this,y),e),h(this,y,a(this,y)+1)}writeU8(e){d(this,k,O).call(this,1),a(this,A).setUint8(a(this,y),e),h(this,y,a(this,y)+1)}writeI16(e){d(this,k,O).call(this,2),a(this,A).setInt16(a(this,y),e,!0),h(this,y,a(this,y)+2)}writeU16(e){d(this,k,O).call(this,2),a(this,A).setUint16(a(this,y),e,!0),h(this,y,a(this,y)+2)}writeI32(e){d(this,k,O).call(this,4),a(this,A).setInt32(a(this,y),e,!0),h(this,y,a(this,y)+4)}writeU32(e){d(this,k,O).call(this,4),a(this,A).setUint32(a(this,y),e,!0),h(this,y,a(this,y)+4)}writeI64(e){d(this,k,O).call(this,8),a(this,A).setBigInt64(a(this,y),e,!0),h(this,y,a(this,y)+8)}writeU64(e){d(this,k,O).call(this,8),a(this,A).setBigUint64(a(this,y),e,!0),h(this,y,a(this,y)+8)}writeU128(e){d(this,k,O).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);a(this,A).setBigUint64(a(this,y),t,!0),a(this,A).setBigUint64(a(this,y)+8,r,!0),h(this,y,a(this,y)+16)}writeI128(e){d(this,k,O).call(this,16);const t=e&BigInt("0xFFFFFFFFFFFFFFFF"),r=e>>BigInt(64);a(this,A).setBigInt64(a(this,y),t,!0),a(this,A).setBigInt64(a(this,y)+8,r,!0),h(this,y,a(this,y)+16)}writeU256(e){d(this,k,O).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,s=e>>BigInt(64*3);a(this,A).setBigUint64(a(this,y)+8*0,r,!0),a(this,A).setBigUint64(a(this,y)+8*1,n,!0),a(this,A).setBigUint64(a(this,y)+8*2,i,!0),a(this,A).setBigUint64(a(this,y)+8*3,s,!0),h(this,y,a(this,y)+32)}writeI256(e){d(this,k,O).call(this,32);const t=BigInt("0xFFFFFFFFFFFFFFFF"),r=e&t,n=e>>BigInt(64*1)&t,i=e>>BigInt(64*2)&t,s=e>>BigInt(64*3);a(this,A).setBigUint64(a(this,y)+8*0,r,!0),a(this,A).setBigUint64(a(this,y)+8*1,n,!0),a(this,A).setBigUint64(a(this,y)+8*2,i,!0),a(this,A).setBigInt64(a(this,y)+8*3,s,!0),h(this,y,a(this,y)+32)}writeF32(e){d(this,k,O).call(this,4),a(this,A).setFloat32(a(this,y),e,!0),h(this,y,a(this,y)+4)}writeF64(e){d(this,k,O).call(this,8),a(this,A).setFloat64(a(this,y),e,!0),h(this,y,a(this,y)+8)}writeString(e){const r=new Sr().encode(e);this.writeU32(r.length),d(this,k,O).call(this,r.length),a(this,$).set(r,a(this,y)),h(this,y,a(this,y)+r.length)}},$=new WeakMap,A=new WeakMap,y=new WeakMap,k=new WeakSet,O=function(e){const t=a(this,y)+e+1;if(t<=a(this,$).length)return;let r=a(this,$).length*2;r<t&&(r=t);const n=new Uint8Array(r);n.set(a(this,$)),h(this,$,n),h(this,A,new DataView(a(this,$).buffer))},cr);function Ht(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r)if(!n.includes(i)||!Ht(e[i],t[i]))return!1;return!0}function Ar(e){return Array.prototype.map.call(e.reverse(),t=>("00"+t.toString(16)).slice(-2)).join("")}function Si(e){if(e.length!=16)throw new Error(`Uint8Array is not 16 bytes long: ${e}`);return new ye(e).readU128()}function Ii(e){if(e.length!=32)throw new Error(`Uint8Array is not 32 bytes long: [${e}]`);return new ye(e).readU256()}function Fr(e){e.startsWith("0x")&&(e=e.slice(2));let t=e.match(/.{1,2}/g)||[],r=Uint8Array.from(t.map(n=>parseInt(n,16)));return r.length!=32?new Uint8Array(0):r.reverse()}function Ai(e){return Si(Fr(e))}function Fi(e){return Ii(Fr(e))}function vr(e){let t=new X(16);return t.writeU128(e),t.getBuffer()}function vi(e){return Ar(vr(e))}function Ur(e){let t=new X(32);return t.writeU256(e),t.getBuffer()}function Ui(e){return Ar(Ur(e))}var ft=class Re{constructor(t){f(this,"data");this.data=t}get __connection_id__(){return this.data}isZero(){return this.data===BigInt(0)}static nullIfZero(t){return t.isZero()?null:t}static random(){function t(){return Math.floor(Math.random()*255)}let r=BigInt(0);for(let n=0;n<16;n++)r=r<<BigInt(8)|BigInt(t());return new Re(r)}isEqual(t){return this.data==t.data}toHexString(){return vi(this.data)}toUint8Array(){return vr(this.data)}static fromString(t){return new Re(Ai(t))}static fromStringOrNull(t){let r=Re.fromString(t);return r.isZero()?null:r}},ee,zi=(ee=class{constructor(t){f(this,"__time_duration_micros__");this.__time_duration_micros__=t}get micros(){return this.__time_duration_micros__}get millis(){return Number(this.micros/ee.MICROS_PER_MILLIS)}static fromMillis(t){return new ee(BigInt(t)*ee.MICROS_PER_MILLIS)}},f(ee,"MICROS_PER_MILLIS",1000n),ee),V,Ei=(V=class{constructor(t){f(this,"__timestamp_micros_since_unix_epoch__");this.__timestamp_micros_since_unix_epoch__=t}get microsSinceUnixEpoch(){return this.__timestamp_micros_since_unix_epoch__}static now(){return V.fromDate(new Date)}static fromDate(t){const r=t.getTime(),n=BigInt(r)*V.MICROS_PER_MILLIS;return new V(n)}toDate(){const r=this.__timestamp_micros_since_unix_epoch__/V.MICROS_PER_MILLIS;if(r>BigInt(Number.MAX_SAFE_INTEGER)||r<BigInt(Number.MIN_SAFE_INTEGER))throw new RangeError("Timestamp is outside of the representable range of JS's Date");return new Date(Number(r))}},f(V,"MICROS_PER_MILLIS",1000n),f(V,"UNIX_EPOCH",new V(0n)),V),Ci=class zr{constructor(t){f(this,"data");this.data=typeof t=="string"?Fi(t):t}get __identity__(){return this.data}isEqual(t){return this.toHexString()===t.toHexString()}toHexString(){return Ui(this.data)}toUint8Array(){return Ur(this.data)}static fromString(t){return new zr(t)}},gt;(e=>{function t(){return o.createSumType([new F("Interval",o.createTimeDurationType()),new F("Time",o.createTimestampType())])}e.getAlgebraicType=t,e.Interval=n=>({tag:"Interval",value:{__time_duration_micros__:n}}),e.Time=n=>({tag:"Time",value:{__timestamp_micros_since_unix_epoch__:n}});function r(n){let i=n.asSumValue();switch(i.tag){case 0:return{tag:"Interval",value:{__time_duration_micros__:i.value.asProductValue().elements[0].asBigInt()}};case 1:return{tag:"Time",value:{__timestamp_micros_since_unix_epoch__:i.value.asBigInt()}};default:throw"unreachable"}}e.fromValue=r})(gt||(gt={}));var Bi=gt,F=class{constructor(e,t){f(this,"name");f(this,"algebraicType");this.name=e,this.algebraicType=t}},ki=class{constructor(e){f(this,"variants");f(this,"serialize",(e,t)=>{if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none")t!=null?(e.writeByte(0),this.variants[0].algebraicType.serialize(e,t)):e.writeByte(1);else{let r=t.tag;const n=this.variants.findIndex(i=>i.name===r);if(n<0)throw`Can't serialize a sum type, couldn't find ${t.tag} tag`;e.writeU8(n),this.variants[n].algebraicType.serialize(e,t.value)}});f(this,"deserialize",e=>{let t=e.readU8();if(this.variants.length==2&&this.variants[0].name==="some"&&this.variants[1].name==="none"){if(t===0)return this.variants[0].algebraicType.deserialize(e);if(t===1)return;throw`Can't deserialize an option type, couldn't find ${t} tag`}else{let r=this.variants[t],n=r.algebraicType.deserialize(e);return{tag:r.name,value:n}}});this.variants=e}},l=class{constructor(e,t){f(this,"name");f(this,"algebraicType");this.name=e,this.algebraicType=t}},Oi=class{constructor(e){f(this,"elements");f(this,"serialize",(e,t)=>{for(let r of this.elements)r.algebraicType.serialize(e,t[r.name])});f(this,"deserialize",e=>{let t={};if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return new zi(e.readI64());if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return new Ei(e.readI64());if(this.elements[0].name==="__identity__")return new Ci(e.readU256());if(this.elements[0].name==="__connection_id__")return new ft(e.readU128())}for(let r of this.elements)t[r.name]=r.algebraicType.deserialize(e);return t});this.elements=e}isEmpty(){return this.elements.length===0}intoMapKey(e){if(this.elements.length===1){if(this.elements[0].name==="__time_duration_micros__")return e.__time_duration_micros__;if(this.elements[0].name==="__timestamp_micros_since_unix_epoch__")return e.__timestamp_micros_since_unix_epoch__;if(this.elements[0].name==="__identity__")return e.__identity__;if(this.elements[0].name==="__connection_id__")return e.__connection_id__}const t=new X(10);return this.serialize(t,e),t.toBase64()}},Di=class{constructor(e,t){f(this,"keyType");f(this,"valueType");this.keyType=e,this.valueType=t}},M,de,C,ce,B,yt,Tt,bt,o=(ce=class{constructor(){_(this,M);f(this,"type");f(this,"type_")}get product(){if(this.type!==u.ProductType)throw"product type was requested, but the type is not ProductType";return this.type_}set product(t){d(this,M,de).call(this,u.ProductType,t)}get sum(){if(this.type!==u.SumType)throw"sum type was requested, but the type is not SumType";return this.type_}set sum(t){d(this,M,de).call(this,u.SumType,t)}get array(){if(this.type!==u.ArrayType)throw"array type was requested, but the type is not ArrayType";return this.type_}set array(t){d(this,M,de).call(this,u.ArrayType,t)}get map(){if(this.type!==u.MapType)throw"map type was requested, but the type is not MapType";return this.type_}set map(t){d(this,M,de).call(this,u.MapType,t)}static createProductType(t){return d(this,C,B).call(this,u.ProductType,new Oi(t))}static createSumType(t){return d(this,C,B).call(this,u.SumType,new ki(t))}static createArrayType(t){return d(this,C,B).call(this,u.ArrayType,t)}static createMapType(t,r){return d(this,C,B).call(this,u.MapType,new Di(t,r))}static createBoolType(){return d(this,C,B).call(this,u.Bool,null)}static createI8Type(){return d(this,C,B).call(this,u.I8,null)}static createU8Type(){return d(this,C,B).call(this,u.U8,null)}static createI16Type(){return d(this,C,B).call(this,u.I16,null)}static createU16Type(){return d(this,C,B).call(this,u.U16,null)}static createI32Type(){return d(this,C,B).call(this,u.I32,null)}static createU32Type(){return d(this,C,B).call(this,u.U32,null)}static createI64Type(){return d(this,C,B).call(this,u.I64,null)}static createU64Type(){return d(this,C,B).call(this,u.U64,null)}static createI128Type(){return d(this,C,B).call(this,u.I128,null)}static createU128Type(){return d(this,C,B).call(this,u.U128,null)}static createI256Type(){return d(this,C,B).call(this,u.I256,null)}static createU256Type(){return d(this,C,B).call(this,u.U256,null)}static createF32Type(){return d(this,C,B).call(this,u.F32,null)}static createF64Type(){return d(this,C,B).call(this,u.F64,null)}static createStringType(){return d(this,C,B).call(this,u.String,null)}static createBytesType(){return this.createArrayType(this.createU8Type())}static createOptionType(t){return this.createSumType([new F("some",t),new F("none",this.createProductType([]))])}static createIdentityType(){return this.createProductType([new l("__identity__",this.createU256Type())])}static createConnectionIdType(){return this.createProductType([new l("__connection_id__",this.createU128Type())])}static createScheduleAtType(){return Bi.getAlgebraicType()}static createTimestampType(){return this.createProductType([new l("__timestamp_micros_since_unix_epoch__",this.createI64Type())])}static createTimeDurationType(){return this.createProductType([new l("__time_duration_micros__",this.createI64Type())])}isProductType(){return this.type===u.ProductType}isSumType(){return this.type===u.SumType}isArrayType(){return this.type===u.ArrayType}isMapType(){return this.type===u.MapType}isIdentity(){return d(this,M,Tt).call(this,"__identity__")}isConnectionId(){return d(this,M,Tt).call(this,"__connection_id__")}isScheduleAt(){return this.isSumType()&&this.sum.variants.length===2&&this.sum.variants[0].name==="Interval"&&this.sum.variants[0].algebraicType.type===u.U64&&this.sum.variants[1].name==="Time"&&this.sum.variants[1].algebraicType.type===u.U64}isTimestamp(){return d(this,M,bt).call(this,"__timestamp_micros_since_unix_epoch__")}isTimeDuration(){return d(this,M,bt).call(this,"__time_duration_micros__")}intoMapKey(t){switch(this.type){case u.U8:case u.U16:case u.U32:case u.U64:case u.U128:case u.U256:case u.I8:case u.I16:case u.I64:case u.I128:case u.F32:case u.F64:case u.String:case u.Bool:return t;case u.ProductType:return this.product.intoMapKey(t);default:const r=new X(10);return this.serialize(r,t),r.toBase64()}}serialize(t,r){switch(this.type){case u.ProductType:this.product.serialize(t,r);break;case u.SumType:this.sum.serialize(t,r);break;case u.ArrayType:if(d(this,M,yt).call(this))t.writeUInt8Array(r);else{const n=this.array;t.writeU32(r.length);for(let i of r)n.serialize(t,i)}break;case u.MapType:throw new Error("not implemented");case u.Bool:t.writeBool(r);break;case u.I8:t.writeI8(r);break;case u.U8:t.writeU8(r);break;case u.I16:t.writeI16(r);break;case u.U16:t.writeU16(r);break;case u.I32:t.writeI32(r);break;case u.U32:t.writeU32(r);break;case u.I64:t.writeI64(r);break;case u.U64:t.writeU64(r);break;case u.I128:t.writeI128(r);break;case u.U128:t.writeU128(r);break;case u.I256:t.writeI256(r);break;case u.U256:t.writeU256(r);break;case u.F32:t.writeF32(r);break;case u.F64:t.writeF64(r);break;case u.String:t.writeString(r);break;default:throw new Error(`not implemented, ${this.type}`)}}deserialize(t){switch(this.type){case u.ProductType:return this.product.deserialize(t);case u.SumType:return this.sum.deserialize(t);case u.ArrayType:if(d(this,M,yt).call(this))return t.readUInt8Array();{const r=this.array,n=t.readU32();let i=[];for(let s=0;s<n;s++)i.push(r.deserialize(t));return i}case u.MapType:throw new Error("not implemented");case u.Bool:return t.readBool();case u.I8:return t.readI8();case u.U8:return t.readU8();case u.I16:return t.readI16();case u.U16:return t.readU16();case u.I32:return t.readI32();case u.U32:return t.readU32();case u.I64:return t.readI64();case u.U64:return t.readU64();case u.I128:return t.readI128();case u.U128:return t.readU128();case u.U256:return t.readU256();case u.F32:return t.readF32();case u.F64:return t.readF64();case u.String:return t.readString();default:throw new Error(`not implemented, ${this.type}`)}}},M=new WeakSet,de=function(t,r){this.type_=r,this.type=r===void 0?u.None:t},C=new WeakSet,B=function(t,r){var i;let n=new ce;return d(i=n,M,de).call(i,t,r),n},yt=function(){return this.isArrayType()&&this.array.type==u.U8},Tt=function(t){return this.isProductType()&&this.product.elements.length===1&&(this.product.elements[0].algebraicType.type==u.U128||this.product.elements[0].algebraicType.type==u.U256)&&this.product.elements[0].name===t},bt=function(t){return this.isProductType()&&this.product.elements.length===1&&this.product.elements[0].algebraicType.type===u.I64&&this.product.elements[0].name===t},_(ce,C),ce);(e=>{(t=>{t.SumType="SumType",t.ProductType="ProductType",t.ArrayType="ArrayType",t.MapType="MapType",t.Bool="Bool",t.I8="I8",t.U8="U8",t.I16="I16",t.U16="U16",t.I32="I32",t.U32="U32",t.I64="I64",t.U64="U64",t.I128="I128",t.U128="U128",t.I256="I256",t.U256="U256",t.F32="F32",t.F64="F64",t.String="String",t.None="None"})(e.Type||(e.Type={}))})(o||(o={}));var u=o.Type;function Pi(e,t){const r=new ye(t);return e.deserialize(r)}var mt;(e=>{e.FixedSize=i=>({tag:"FixedSize",value:i}),e.RowOffsets=i=>({tag:"RowOffsets",value:i});function t(){return o.createSumType([new F("FixedSize",o.createU16Type()),new F("RowOffsets",o.createArrayType(o.createU64Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(mt||(mt={}));var Fe;(e=>{function t(){return o.createProductType([new l("sizeHint",mt.getTypeScriptAlgebraicType()),new l("rowsData",o.createArrayType(o.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Fe||(Fe={}));var _t;(e=>{function t(){return o.createProductType([new l("reducer",o.createStringType()),new l("args",o.createArrayType(o.createU8Type())),new l("requestId",o.createU32Type()),new l("flags",o.createU8Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(_t||(_t={}));var wt;(e=>{function t(){return o.createProductType([new l("queryStrings",o.createArrayType(o.createStringType())),new l("requestId",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(wt||(wt={}));var xt;(e=>{function t(){return o.createProductType([new l("messageId",o.createArrayType(o.createU8Type())),new l("queryString",o.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(xt||(xt={}));var Y;(e=>{function t(){return o.createProductType([new l("id",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Y||(Y={}));var St;(e=>{function t(){return o.createProductType([new l("query",o.createStringType()),new l("requestId",o.createU32Type()),new l("queryId",Y.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(St||(St={}));var It;(e=>{function t(){return o.createProductType([new l("queryStrings",o.createArrayType(o.createStringType())),new l("requestId",o.createU32Type()),new l("queryId",Y.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(It||(It={}));var At;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("queryId",Y.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(At||(At={}));var Ft;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("queryId",Y.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ft||(Ft={}));var ge;(e=>{e.CallReducer=i=>({tag:"CallReducer",value:i}),e.Subscribe=i=>({tag:"Subscribe",value:i}),e.OneOffQuery=i=>({tag:"OneOffQuery",value:i}),e.SubscribeSingle=i=>({tag:"SubscribeSingle",value:i}),e.SubscribeMulti=i=>({tag:"SubscribeMulti",value:i}),e.Unsubscribe=i=>({tag:"Unsubscribe",value:i}),e.UnsubscribeMulti=i=>({tag:"UnsubscribeMulti",value:i});function t(){return o.createSumType([new F("CallReducer",_t.getTypeScriptAlgebraicType()),new F("Subscribe",wt.getTypeScriptAlgebraicType()),new F("OneOffQuery",xt.getTypeScriptAlgebraicType()),new F("SubscribeSingle",St.getTypeScriptAlgebraicType()),new F("SubscribeMulti",It.getTypeScriptAlgebraicType()),new F("Unsubscribe",At.getTypeScriptAlgebraicType()),new F("UnsubscribeMulti",Ft.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(ge||(ge={}));var Ve;(e=>{function t(){return o.createProductType([new l("deletes",Fe.getTypeScriptAlgebraicType()),new l("inserts",Fe.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ve||(Ve={}));var vt;(e=>{e.Uncompressed=i=>({tag:"Uncompressed",value:i}),e.Brotli=i=>({tag:"Brotli",value:i}),e.Gzip=i=>({tag:"Gzip",value:i});function t(){return o.createSumType([new F("Uncompressed",Ve.getTypeScriptAlgebraicType()),new F("Brotli",o.createArrayType(o.createU8Type())),new F("Gzip",o.createArrayType(o.createU8Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(vt||(vt={}));var Ke;(e=>{function t(){return o.createProductType([new l("tableId",o.createU32Type()),new l("tableName",o.createStringType()),new l("numRows",o.createU64Type()),new l("updates",o.createArrayType(vt.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ke||(Ke={}));var he;(e=>{function t(){return o.createProductType([new l("tables",o.createArrayType(Ke.getTypeScriptAlgebraicType()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(he||(he={}));var Ut;(e=>{function t(){return o.createProductType([new l("databaseUpdate",he.getTypeScriptAlgebraicType()),new l("requestId",o.createU32Type()),new l("totalHostExecutionDuration",o.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ut||(Ut={}));var zt;(e=>{e.Committed=i=>({tag:"Committed",value:i}),e.Failed=i=>({tag:"Failed",value:i}),e.OutOfEnergy={tag:"OutOfEnergy"};function t(){return o.createSumType([new F("Committed",he.getTypeScriptAlgebraicType()),new F("Failed",o.createStringType()),new F("OutOfEnergy",o.createProductType([]))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(zt||(zt={}));var Et;(e=>{function t(){return o.createProductType([new l("reducerName",o.createStringType()),new l("reducerId",o.createU32Type()),new l("args",o.createArrayType(o.createU8Type())),new l("requestId",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Et||(Et={}));var Ct;(e=>{function t(){return o.createProductType([new l("quanta",o.createU128Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ct||(Ct={}));var Bt;(e=>{function t(){return o.createProductType([new l("status",zt.getTypeScriptAlgebraicType()),new l("timestamp",o.createTimestampType()),new l("callerIdentity",o.createIdentityType()),new l("callerConnectionId",o.createConnectionIdType()),new l("reducerCall",Et.getTypeScriptAlgebraicType()),new l("energyQuantaUsed",Ct.getTypeScriptAlgebraicType()),new l("totalHostExecutionDuration",o.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Bt||(Bt={}));var kt;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("update",he.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(kt||(kt={}));var Ot;(e=>{function t(){return o.createProductType([new l("identity",o.createIdentityType()),new l("token",o.createStringType()),new l("connectionId",o.createConnectionIdType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ot||(Ot={}));var Dt;(e=>{function t(){return o.createProductType([new l("tableName",o.createStringType()),new l("rows",Fe.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Dt||(Dt={}));var Pt;(e=>{function t(){return o.createProductType([new l("messageId",o.createArrayType(o.createU8Type())),new l("error",o.createOptionType(o.createStringType())),new l("tables",o.createArrayType(Dt.getTypeScriptAlgebraicType())),new l("totalHostExecutionDuration",o.createTimeDurationType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Pt||(Pt={}));var Je;(e=>{function t(){return o.createProductType([new l("tableId",o.createU32Type()),new l("tableName",o.createStringType()),new l("tableRows",Ke.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Je||(Je={}));var jt;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("totalHostExecutionDurationMicros",o.createU64Type()),new l("queryId",Y.getTypeScriptAlgebraicType()),new l("rows",Je.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(jt||(jt={}));var Rt;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("totalHostExecutionDurationMicros",o.createU64Type()),new l("queryId",Y.getTypeScriptAlgebraicType()),new l("rows",Je.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Rt||(Rt={}));var Mt;(e=>{function t(){return o.createProductType([new l("totalHostExecutionDurationMicros",o.createU64Type()),new l("requestId",o.createOptionType(o.createU32Type())),new l("queryId",o.createOptionType(o.createU32Type())),new l("tableId",o.createOptionType(o.createU32Type())),new l("error",o.createStringType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Mt||(Mt={}));var Nt;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("totalHostExecutionDurationMicros",o.createU64Type()),new l("queryId",Y.getTypeScriptAlgebraicType()),new l("update",he.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Nt||(Nt={}));var qt;(e=>{function t(){return o.createProductType([new l("requestId",o.createU32Type()),new l("totalHostExecutionDurationMicros",o.createU64Type()),new l("queryId",Y.getTypeScriptAlgebraicType()),new l("update",he.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(qt||(qt={}));var Lt;(e=>{e.InitialSubscription=i=>({tag:"InitialSubscription",value:i}),e.TransactionUpdate=i=>({tag:"TransactionUpdate",value:i}),e.TransactionUpdateLight=i=>({tag:"TransactionUpdateLight",value:i}),e.IdentityToken=i=>({tag:"IdentityToken",value:i}),e.OneOffQueryResponse=i=>({tag:"OneOffQueryResponse",value:i}),e.SubscribeApplied=i=>({tag:"SubscribeApplied",value:i}),e.UnsubscribeApplied=i=>({tag:"UnsubscribeApplied",value:i}),e.SubscriptionError=i=>({tag:"SubscriptionError",value:i}),e.SubscribeMultiApplied=i=>({tag:"SubscribeMultiApplied",value:i}),e.UnsubscribeMultiApplied=i=>({tag:"UnsubscribeMultiApplied",value:i});function t(){return o.createSumType([new F("InitialSubscription",Ut.getTypeScriptAlgebraicType()),new F("TransactionUpdate",Bt.getTypeScriptAlgebraicType()),new F("TransactionUpdateLight",kt.getTypeScriptAlgebraicType()),new F("IdentityToken",Ot.getTypeScriptAlgebraicType()),new F("OneOffQueryResponse",Pt.getTypeScriptAlgebraicType()),new F("SubscribeApplied",jt.getTypeScriptAlgebraicType()),new F("UnsubscribeApplied",Rt.getTypeScriptAlgebraicType()),new F("SubscriptionError",Mt.getTypeScriptAlgebraicType()),new F("SubscribeMultiApplied",Nt.getTypeScriptAlgebraicType()),new F("UnsubscribeMultiApplied",qt.getTypeScriptAlgebraicType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Lt||(Lt={}));var le,lr,it=(lr=class{constructor(){_(this,le,new Map)}on(e,t){let r=a(this,le).get(e);r||(r=new Set,a(this,le).set(e,r)),r.add(t)}off(e,t){let r=a(this,le).get(e);r&&r.delete(t)}emit(e,...t){let r=a(this,le).get(e);if(r)for(let n of r)n(...t)}},le=new WeakMap,lr),ji={component:"📦",info:"ℹ️",warn:"⚠️",error:"❌",debug:"🐛"},Ri={component:"color: #fff; background-color: #8D6FDD; padding: 2px 5px; border-radius: 3px;",info:"color: #fff; background-color: #007bff; padding: 2px 5px; border-radius: 3px;",warn:"color: #fff; background-color: #ffc107; padding: 2px 5px; border-radius: 3px;",error:"color: #fff; background-color: #dc3545; padding: 2px 5px; border-radius: 3px;",debug:"color: #fff; background-color: #28a745; padding: 2px 5px; border-radius: 3px;"},Mi={component:"color: #8D6FDD;",info:"color: #007bff;",warn:"color: #ffc107;",error:"color: #dc3545;",debug:"color: #28a745;"},se=(e,t)=>{console.log(`%c${ji[e]} ${e.toUpperCase()}%c ${t}`,Ri[e],Mi[e])},Ni=class{constructor(e){f(this,"rows");f(this,"tableTypeInfo");f(this,"emitter");f(this,"applyOperations",(e,t)=>{const r=[];if(this.tableTypeInfo.primaryKeyInfo!==void 0){const n=new Map,i=new Map;for(const s of e)if(s.type==="insert"){const[c,p]=n.get(s.rowId)||[s,0];n.set(s.rowId,[s,p+1])}else{const[c,p]=i.get(s.rowId)||[s,0];i.set(s.rowId,[s,p+1])}for(const[s,[c,p]]of n){const T=i.get(s);if(T){const[m,I]=T,z=p-I,P=this.update(t,s,c.row,z);P&&r.push(P),i.delete(s)}else{const m=this.insert(t,c,p);m&&r.push(m)}}for(const[s,c]of i.values()){const p=this.delete(t,s,c);p&&r.push(p)}}else for(const n of e)if(n.type==="insert"){const i=this.insert(t,n);i&&r.push(i)}else{const i=this.delete(t,n);i&&r.push(i)}return r});f(this,"update",(e,t,r,n=0)=>{const i=this.rows.get(t);if(!i){se("error",`Updating a row that was not present in the cache. Table: ${this.tableTypeInfo.tableName}, RowId: ${t}`);return}const[s,c]=i,p=Math.max(1,c+n);if(c+n<=0){se("error",`Negative reference count for in table ${this.tableTypeInfo.tableName} row ${t} (${c} + ${n})`);return}return this.rows.set(t,[r,p]),c===0?(se("error",`Updating a row id in table ${this.tableTypeInfo.tableName} which was not present in the cache (rowId: ${t})`),{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,r)}}):{type:"update",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("update",e,s,r)}}});f(this,"insert",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(this.rows.set(t.rowId,[t.row,i+r]),i===0)return{type:"insert",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("insert",e,t.row)}}});f(this,"delete",(e,t,r=1)=>{const[n,i]=this.rows.get(t.rowId)||[t.row,0];if(i===0){se("warn","Deleting a row that was not present in the cache");return}if(i<=r)return this.rows.delete(t.rowId),{type:"delete",table:this.tableTypeInfo.tableName,cb:()=>{this.emitter.emit("delete",e,t.row)}};this.rows.set(t.rowId,[t.row,i-r])});f(this,"onInsert",e=>{this.emitter.on("insert",e)});f(this,"onDelete",e=>{this.emitter.on("delete",e)});f(this,"onUpdate",e=>{this.emitter.on("update",e)});f(this,"removeOnInsert",e=>{this.emitter.off("insert",e)});f(this,"removeOnDelete",e=>{this.emitter.off("delete",e)});f(this,"removeOnUpdate",e=>{this.emitter.off("update",e)});this.tableTypeInfo=e,this.rows=new Map,this.emitter=new it}count(){return this.rows.size}iter(){return Array.from(this.rows.values()).map(([e])=>e)}},qi=class{constructor(){f(this,"tables");this.tables=new Map}getTable(e){const t=this.tables.get(e);if(!t)throw console.error("The table has not been registered for this client. Please register the table before using it. If you have registered global tables using the SpacetimeDBClient.registerTables() or `registerTable()` method, please make sure that is executed first!"),new Error(`Table ${e} does not exist`);return t}getOrCreateTable(e){let t;return this.tables.has(e.tableName)?t=this.tables.get(e.tableName):(t=new Ni(e),this.tables.set(e.tableName,t)),t}};function Li(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const i=e[n],s=t[n];if(i!==s)return typeof i=="number"&&typeof s=="number"?i-s:typeof i=="string"&&typeof s=="string"?i.localeCompare(s):typeof i=="string"?1:-1}return e.length-t.length}var Er=class $t{constructor(t,r,n,i=null,s=null){f(this,"major");f(this,"minor");f(this,"patch");f(this,"preRelease");f(this,"buildInfo");this.major=t,this.minor=r,this.patch=n,this.preRelease=i,this.buildInfo=s}toString(){let t=`${this.major}.${this.minor}.${this.patch}`;return this.preRelease&&(t+=`-${this.preRelease.join(".")}`),this.buildInfo&&(t+=`+${this.buildInfo}`),t}compare(t){return this.major!==t.major?this.major-t.major:this.minor!==t.minor?this.minor-t.minor:this.patch!==t.patch?this.patch-t.patch:this.preRelease&&t.preRelease?Li(this.preRelease,t.preRelease):this.preRelease||t.preRelease?-1:0}clone(){return new $t(this.major,this.minor,this.patch,this.preRelease?[...this.preRelease]:null,this.buildInfo)}static parseVersionString(t){const r=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?(?:\+([\da-zA-Z-]+(?:\.[\da-zA-Z-]+)*))?$/,n=t.match(r);if(!n)throw new Error(`Invalid version string: ${t}`);const i=parseInt(n[1],10),s=parseInt(n[2],10),c=parseInt(n[3],10),p=n[4]?n[4].split(".").map(m=>isNaN(Number(m))?m:Number(m)):null,T=n[5]||null;return new $t(i,s,c,p,T)}},Cr=new Er(1,2,0);function $i(e){if(e===void 0)throw new Error(rr(e));if(Er.parseVersionString(e).compare(Cr)<0)throw new Error(rr(e))}function rr(e){return`Module code was generated with an incompatible version of the spacetimedb cli (${e}).  Update the cli version to at least ${Cr.toString()} and regenerate the bindings. You can upgrade to the latest cli version by running: spacetime version upgrade`}async function Br(e,t,r=128*1024){let n=0;const i=new ReadableStream({pull(q){if(n<e.length){const H=e.subarray(n,Math.min(n+r,e.length));q.enqueue(H),n+=r}else q.close()}}),s=new DecompressionStream(t),p=i.pipeThrough(s).getReader(),T=[];let m=0,I;for(;!(I=await p.read()).done;)T.push(I.value),m+=I.value.length;const z=new Uint8Array(m);let P=0;for(const q of T)z.set(q,P),P+=q.length;return z}var Te,te,kr,Or,Vt,be,Vi=(be=class{constructor(t){_(this,te);f(this,"onclose");f(this,"onopen");f(this,"onmessage");f(this,"onerror");_(this,Te);this.onmessage=void 0,this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,t.onmessage=d(this,te,kr).bind(this),t.onerror=d(this,te,Vt).bind(this),t.onclose=d(this,te,Vt).bind(this),t.onopen=d(this,te,Or).bind(this),t.binaryType="arraybuffer",h(this,Te,t)}send(t){a(this,Te).send(t)}close(){a(this,Te).close()}static async createWebSocketFn({url:t,nameOrAddress:r,wsProtocol:n,authToken:i,compression:s,lightMode:c}){const p=new Headers;let T;T=WebSocket;let m;if(i){p.set("Authorization",`Bearer ${i}`);const P=new URL("v1/identity/websocket-token",t);P.protocol=t.protocol==="wss:"?"https:":"http:";const q=await fetch(P,{method:"POST",headers:p});if(q.ok){const{token:H}=await q.json();m=H}else return Promise.reject(new Error(`Failed to verify token: ${q.statusText}`))}const I=new URL(`v1/database/${r}/subscribe`,t);m&&I.searchParams.set("token",m),I.searchParams.set("compression",s==="gzip"?"Gzip":"None"),c&&I.searchParams.set("light","true");const z=new T(I.toString(),n);return new be(z)}},Te=new WeakMap,te=new WeakSet,kr=async function(t){var i;const r=new Uint8Array(t.data);let n;if(r[0]===0)n=r.slice(1);else{if(r[0]===1)throw new Error("Brotli Compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");if(r[0]===2)n=await Br(r.slice(1),"gzip");else throw new Error("Unexpected Compression Algorithm. Please use `gzip` or `none`")}(i=this.onmessage)==null||i.call(this,{data:n})},Or=function(t){var r;(r=this.onopen)==null||r.call(this,t)},Vt=function(t){var r;(r=this.onerror)==null||r.call(this,t)},be),me,_e,et,ve,ue,Ue,ze,we,ur,Ki=(ur=class{constructor(e,t){_(this,me);_(this,_e);_(this,et);_(this,ve);_(this,ue,new it);_(this,Ue,"gzip");_(this,ze,!1);_(this,we);this.remoteModule=e,this.dbConnectionConstructor=t,h(this,we,Vi.createWebSocketFn)}withUri(e){return h(this,me,new URL(e)),this}withModuleName(e){return h(this,_e,e),this}withToken(e){return h(this,ve,e),this}withWSFn(e){return h(this,we,e),this}withCompression(e){return h(this,Ue,e),this}withLightMode(e){return h(this,ze,e),this}onConnect(e){return a(this,ue).on("connect",e),this}onConnectError(e){return a(this,ue).on("connectError",e),this}onDisconnect(e){return a(this,ue).on("disconnect",e),this}build(){var e;if(!a(this,me))throw new Error("URI is required to connect to SpacetimeDB");if(!a(this,_e))throw new Error("Database name or address is required to connect to SpacetimeDB");return $i((e=this.remoteModule.versionInfo)==null?void 0:e.cliVersion),this.dbConnectionConstructor(new Pr({uri:a(this,me),nameOrAddress:a(this,_e),identity:a(this,et),token:a(this,ve),emitter:a(this,ue),compression:a(this,Ue),lightMode:a(this,ze),createWSFn:a(this,we),remoteModule:this.remoteModule}))}},me=new WeakMap,_e=new WeakMap,et=new WeakMap,ve=new WeakMap,ue=new WeakMap,Ue=new WeakMap,ze=new WeakMap,we=new WeakMap,ur),Ee,Ce,pr,Dr=(pr=class{constructor(e){_(this,Ee);_(this,Ce);this.db=e}onApplied(e){return h(this,Ee,e),this}onError(e){return h(this,Ce,e),this}subscribe(e){const t=Array.isArray(e)?e:[e];if(t.length===0)throw new Error("Subscriptions must have at least one query");return new Hi(this.db,t,a(this,Ee),a(this,Ce))}subscribeToAllTables(){this.subscribe("SELECT * FROM *")}},Ee=new WeakMap,Ce=new WeakMap,pr),Ji=class{constructor(){f(this,"subscriptions",new Map)}},xe,pe,re,ie,ne,hr,Hi=(hr=class{constructor(e,t,r,n){_(this,xe);_(this,pe,!1);_(this,re,!1);_(this,ie,!1);_(this,ne,new it);this.db=e,a(this,ne).on("applied",i=>{h(this,ie,!0),r&&r(i)}),a(this,ne).on("error",(i,s)=>{h(this,ie,!1),h(this,re,!0),n&&n(i,s)}),h(this,xe,this.db.registerSubscription(this,a(this,ne),t))}unsubscribe(){if(a(this,pe))throw new Error("Unsubscribe has already been called");h(this,pe,!0),this.db.unregisterSubscription(a(this,xe)),a(this,ne).on("end",e=>{h(this,re,!0),h(this,ie,!1)})}unsubscribeThen(e){if(a(this,re))throw new Error("Subscription has already ended");if(a(this,pe))throw new Error("Unsubscribe has already been called");h(this,pe,!0),this.db.unregisterSubscription(a(this,xe)),a(this,ne).on("end",t=>{h(this,re,!0),h(this,ie,!1),e(t)})}isEnded(){return a(this,re)}isActive(){return a(this,ie)}},xe=new WeakMap,pe=new WeakMap,re=new WeakMap,ie=new WeakMap,ne=new WeakMap,hr);function Gi(e){switch(e){case"FullUpdate":return 0;case"NoSuccessNotify":return 1}}var Be,j,Se,tt,D,ke,W,rt,v,jr,Me,Rr,oe,Mr,Nr,Wi,Zi,Xi,Yi,Qi,en,tn,rn,dr,Pr=(dr=class{constructor({uri:e,nameOrAddress:t,identity:r,token:n,emitter:i,remoteModule:s,createWSFn:c,compression:p,lightMode:T}){_(this,v);f(this,"isActive",!1);f(this,"identity");f(this,"token");f(this,"db");f(this,"reducers");f(this,"setReducerFlags");f(this,"connectionId",ft.random());_(this,Be,0);_(this,j);_(this,Se,new it);_(this,tt);_(this,D);_(this,ke,Promise.resolve());_(this,W,new Ji);f(this,"clientCache");f(this,"ws");f(this,"wsPromise");_(this,rt,()=>{const e=a(this,Be);return h(this,Be,a(this,Be)+1),e});f(this,"subscriptionBuilder",()=>new Dr(this));se("info","Connecting to SpacetimeDB WS...");let m=new URL(e.toString());/^wss?:/.test(e.protocol)||(m.protocol=m.protocol==="https:"?"wss:":"ws:"),this.identity=r,this.token=n,h(this,D,s),h(this,j,i);let I=this.connectionId.toHexString();m.searchParams.set("connection_id",I),this.clientCache=new qi,this.db=a(this,D).dbViewConstructor(this),this.setReducerFlags=a(this,D).setReducerFlagsConstructor(),this.reducers=a(this,D).reducersConstructor(this,this.setReducerFlags),this.wsPromise=c({url:m,nameOrAddress:t,wsProtocol:"v1.bsatn.spacetimedb",authToken:n,compression:p,lightMode:T}).then(z=>(this.ws=z,this.ws.onclose=()=>{a(this,j).emit("disconnect",this)},this.ws.onerror=P=>{a(this,j).emit("connectError",this,P)},this.ws.onopen=d(this,v,Rr).bind(this),this.ws.onmessage=d(this,v,Nr).bind(this),z)).catch(z=>{se("error","Error connecting to SpacetimeDB WS"),a(this,j).emit("connectError",this,z)})}registerSubscription(e,t,r){const n=a(this,rt).call(this);return a(this,W).subscriptions.set(n,{handle:e,emitter:t}),d(this,v,Me).call(this,ge.SubscribeMulti({queryStrings:r,queryId:{id:n},requestId:0})),n}unregisterSubscription(e){d(this,v,Me).call(this,ge.UnsubscribeMulti({queryId:{id:e},requestId:0}))}callReducer(e,t,r){const n=ge.CallReducer({reducer:e,args:t,requestId:0,flags:Gi(r)});d(this,v,Me).call(this,n)}disconnect(){this.wsPromise.then(e=>{e&&e.close()})}onReducer(e,t){a(this,Se).on(e,t)}offReducer(e,t){a(this,Se).off(e,t)}},Be=new WeakMap,j=new WeakMap,Se=new WeakMap,tt=new WeakMap,D=new WeakMap,ke=new WeakMap,W=new WeakMap,rt=new WeakMap,v=new WeakSet,jr=async function(e){const t=(i,s,c)=>{const p=c.rowsData,T=new ye(p),m=[],I=a(this,D).tables[s].rowType,z=a(this,D).tables[s].primaryKeyInfo;for(;T.offset<p.length+p.byteOffset;){const P=T.offset,q=I.deserialize(T);let H;if(z!==void 0)H=z.colType.intoMapKey(q[z.colName]);else{const Q=p.subarray(P-p.byteOffset,T.offset-p.byteOffset);H=Ir(Q)}m.push({type:i,rowId:H,row:q})}return m},r=async i=>{const s=i.tableName;let c=[];for(const p of i.updates){let T;if(p.tag==="Gzip"){const m=await Br(p.value,"gzip");T=Ve.deserialize(new ye(m))}else{if(p.tag==="Brotli")throw new Error("Brotli compression not supported. Please use gzip or none compression in withCompression method on DbConnection.");T=p.value}c=c.concat(t("insert",s,T.inserts)),c=c.concat(t("delete",s,T.deletes))}return{tableName:s,operations:c}},n=async i=>{const s=[];for(const c of i.tables)s.push(await r(c));return s};switch(e.tag){case"InitialSubscription":{const i=e.value.databaseUpdate;return{tag:"InitialSubscription",tableUpdates:await n(i)}}case"TransactionUpdateLight":{const i=e.value.update;return{tag:"TransactionUpdateLight",tableUpdates:await n(i)}}case"TransactionUpdate":{const i=e.value,s=i.callerIdentity,c=ft.nullIfZero(i.callerConnectionId),p=i.reducerCall.reducerName,T=i.reducerCall.args,m=i.energyQuantaUsed;let I,z="";switch(i.status.tag){case"Committed":I=await n(i.status.value);break;case"Failed":I=[],z=i.status.value;break;case"OutOfEnergy":I=[];break}if(p==="<none>"){console.error(`Received an error from the database: ${z}`);return}let P;return p!==""&&(P={reducerName:p,args:T}),{tag:"TransactionUpdate",tableUpdates:I,identity:s,connectionId:c,reducerInfo:P,status:i.status,energyConsumed:m.quanta,message:z,timestamp:i.timestamp}}case"IdentityToken":return{tag:"IdentityToken",identity:e.value.identity,token:e.value.token,connectionId:e.value.connectionId};case"OneOffQueryResponse":throw new Error(`TypeScript SDK never sends one-off queries, but got OneOffQueryResponse ${e}`);case"SubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"SubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"UnsubscribeMultiApplied":{const i=await n(e.value.update);return{tag:"UnsubscribeApplied",queryId:e.value.queryId.id,tableUpdates:i}}case"SubscriptionError":return{tag:"SubscriptionError",queryId:e.value.queryId,error:e.value.error}}},Me=function(e){this.wsPromise.then(t=>{if(t){const r=new X(1024);ge.serialize(r,e);const n=r.getBuffer();t.send(n)}})},Rr=function(){this.isActive=!0},oe=function(e,t){let r=[];for(let n of e){const i=n.tableName,s=a(this,D).tables[i],p=this.clientCache.getOrCreateTable(s).applyOperations(n.operations,t);for(const T of p)r.push(T)}return r},Mr=async function(e){var n,i;const t=Pi(Lt,e),r=await d(this,v,jr).call(this,t);if(r)switch(r.tag){case"InitialSubscription":{let s={tag:"SubscribeApplied"};const c=a(this,D).eventContextConstructor(this,s),{event:p,...T}=c,m=d(this,v,oe).call(this,r.tableUpdates,c);a(this,j)&&((n=a(this,tt))==null||n.call(this,T));for(const I of m)I.cb();break}case"TransactionUpdateLight":{let s={tag:"UnknownTransaction"};const c=a(this,D).eventContextConstructor(this,s),p=d(this,v,oe).call(this,r.tableUpdates,c);for(const T of p)T.cb();break}case"TransactionUpdate":{let s=r.reducerInfo,c=!1,p,T;if(!s)c=!0;else{T=a(this,D).reducers[s.reducerName];try{const Q=new ye(s.args);p=T.argsType.deserialize(Q)}catch{console.debug("Failed to deserialize reducer arguments"),c=!0}}if(c){const Q={tag:"UnknownTransaction"},nt=a(this,D).eventContextConstructor(this,Q),$r=d(this,v,oe).call(this,r.tableUpdates,nt);for(const Vr of $r)Vr.cb();return}s=s,T=T;const m={callerIdentity:r.identity,status:r.status,callerConnectionId:r.connectionId,timestamp:r.timestamp,energyConsumed:r.energyConsumed,reducer:{name:s.reducerName,args:p}},I={tag:"Reducer",value:m},z=a(this,D).eventContextConstructor(this,I),P={...z,event:m},q=d(this,v,oe).call(this,r.tableUpdates,z),H=[];T.argsType.product.elements.forEach((Q,nt)=>{H.push(p[Q.name])}),a(this,Se).emit(s.reducerName,P,...H);for(const Q of q)Q.cb();break}case"IdentityToken":{this.identity=r.identity,!this.token&&r.token&&(this.token=r.token),this.connectionId=r.connectionId,a(this,j).emit("connect",this,this.identity,this.token);break}case"SubscribeApplied":{const s=a(this,W).subscriptions.get(r.queryId);if(s===void 0){se("error",`Received SubscribeApplied for unknown queryId ${r.queryId}.`);break}const c={tag:"SubscribeApplied"},p=a(this,D).eventContextConstructor(this,c),{event:T,...m}=p,I=d(this,v,oe).call(this,r.tableUpdates,p);s==null||s.emitter.emit("applied",m);for(const z of I)z.cb();break}case"UnsubscribeApplied":{const s=a(this,W).subscriptions.get(r.queryId);if(s===void 0){se("error",`Received UnsubscribeApplied for unknown queryId ${r.queryId}.`);break}const c={tag:"UnsubscribeApplied"},p=a(this,D).eventContextConstructor(this,c),{event:T,...m}=p,I=d(this,v,oe).call(this,r.tableUpdates,p);s==null||s.emitter.emit("end",m),a(this,W).subscriptions.delete(r.queryId);for(const z of I)z.cb();break}case"SubscriptionError":{const s=Error(r.error),c={tag:"Error",value:s},T={...a(this,D).eventContextConstructor(this,c),event:s};r.queryId!==void 0?((i=a(this,W).subscriptions.get(r.queryId))==null||i.emitter.emit("error",T,s),a(this,W).subscriptions.delete(r.queryId)):(console.error("Received an error message without a queryId: ",s),a(this,W).subscriptions.forEach(({emitter:m})=>{m.emit("error",T,s)}))}}},Nr=function(e){h(this,ke,a(this,ke).then(()=>d(this,v,Mr).call(this,e.data)))},Wi=function(e,t){a(this,j).on(e,t)},Zi=function(e,t){a(this,j).off(e,t)},Xi=function(e){a(this,j).on("connect",e)},Yi=function(e){a(this,j).on("disconnect",e)},Qi=function(e){a(this,j).on("connectError",e)},en=function(e){a(this,j).off("connect",e)},tn=function(e){a(this,j).off("disconnect",e)},rn=function(e){a(this,j).off("connectError",e)},dr),He;(e=>{function t(){return o.createProductType([new l("voteId",o.createU64Type()),new l("optionId",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(He||(He={}));var Ge;(e=>{function t(){return o.createProductType([new l("title",o.createStringType()),new l("options",o.createArrayType(o.createStringType())),new l("isPublic",o.createOptionType(o.createBoolType()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ge||(Ge={}));var We;(e=>{function t(){return o.createProductType([new l("voteId",o.createU64Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(We||(We={}));var Ze;(e=>{function t(){return o.createProductType([new l("voteId",o.createU64Type()),new l("optionIds",o.createArrayType(o.createU32Type()))])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ze||(Ze={}));var Xe;(e=>{function t(){return o.createProductType([new l("voteId",o.createU64Type()),new l("optionId",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Xe||(Xe={}));class nn{constructor(t){this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class sn{constructor(t){this.id={find:r=>{for(let n of this.tableCache.iter())if(Ht(n.id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}class an{constructor(t){this.id={find:r=>{for(let n of this.tableCache.iter())if(Ht(n.id,r))return n}},this.onInsert=r=>this.tableCache.onInsert(r),this.removeOnInsert=r=>this.tableCache.removeOnInsert(r),this.onDelete=r=>this.tableCache.onDelete(r),this.removeOnDelete=r=>this.tableCache.removeOnDelete(r),this.onUpdate=r=>this.tableCache.onUpdate(r),this.removeOnUpdate=r=>this.tableCache.removeOnUpdate(r),this.tableCache=t}count(){return this.tableCache.count()}iter(){return this.tableCache.iter()}}var Kt;(e=>{function t(){return o.createProductType([new l("voteId",o.createU64Type()),new l("optionId",o.createU32Type()),new l("voter",o.createIdentityType()),new l("ts",o.createTimestampType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Kt||(Kt={}));var Ye;(e=>{function t(){return o.createProductType([new l("id",o.createU64Type()),new l("creator",o.createIdentityType()),new l("title",o.createStringType()),new l("public",o.createBoolType()),new l("createdAt",o.createTimestampType())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Ye||(Ye={}));var Qe;(e=>{function t(){return o.createProductType([new l("id",o.createU32Type()),new l("voteId",o.createU64Type()),new l("label",o.createStringType()),new l("approvalsCount",o.createU32Type()),new l("orderIndex",o.createU32Type())])}e.getTypeScriptAlgebraicType=t;function r(i,s){e.getTypeScriptAlgebraicType().serialize(i,s)}e.serialize=r;function n(i){return e.getTypeScriptAlgebraicType().deserialize(i)}e.deserialize=n})(Qe||(Qe={}));const Ne={tables:{approval:{tableName:"approval",rowType:Kt.getTypeScriptAlgebraicType()},vote:{tableName:"vote",rowType:Ye.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:Ye.getTypeScriptAlgebraicType().product.elements[0].algebraicType}},vote_option:{tableName:"vote_option",rowType:Qe.getTypeScriptAlgebraicType(),primaryKey:"id",primaryKeyInfo:{colName:"id",colType:Qe.getTypeScriptAlgebraicType().product.elements[0].algebraicType}}},reducers:{approve:{reducerName:"approve",argsType:He.getTypeScriptAlgebraicType()},create_vote:{reducerName:"create_vote",argsType:Ge.getTypeScriptAlgebraicType()},delete_vote:{reducerName:"delete_vote",argsType:We.getTypeScriptAlgebraicType()},set_approvals:{reducerName:"set_approvals",argsType:Ze.getTypeScriptAlgebraicType()},unapprove:{reducerName:"unapprove",argsType:Xe.getTypeScriptAlgebraicType()}},versionInfo:{cliVersion:"1.3.2"},eventContextConstructor:(e,t)=>({...e,event:t}),dbViewConstructor:e=>new ln(e),reducersConstructor:(e,t)=>new on(e,t),setReducerFlagsConstructor:()=>new cn};class on{constructor(t,r){this.connection=t,this.setCallReducerFlags=r}approve(t,r){const n={voteId:t,optionId:r};let i=new X(1024);He.getTypeScriptAlgebraicType().serialize(i,n);let s=i.getBuffer();this.connection.callReducer("approve",s,this.setCallReducerFlags.approveFlags)}onApprove(t){this.connection.onReducer("approve",t)}removeOnApprove(t){this.connection.offReducer("approve",t)}createVote(t,r,n){const i={title:t,options:r,isPublic:n};let s=new X(1024);Ge.getTypeScriptAlgebraicType().serialize(s,i);let c=s.getBuffer();this.connection.callReducer("create_vote",c,this.setCallReducerFlags.createVoteFlags)}onCreateVote(t){this.connection.onReducer("create_vote",t)}removeOnCreateVote(t){this.connection.offReducer("create_vote",t)}deleteVote(t){const r={voteId:t};let n=new X(1024);We.getTypeScriptAlgebraicType().serialize(n,r);let i=n.getBuffer();this.connection.callReducer("delete_vote",i,this.setCallReducerFlags.deleteVoteFlags)}onDeleteVote(t){this.connection.onReducer("delete_vote",t)}removeOnDeleteVote(t){this.connection.offReducer("delete_vote",t)}setApprovals(t,r){const n={voteId:t,optionIds:r};let i=new X(1024);Ze.getTypeScriptAlgebraicType().serialize(i,n);let s=i.getBuffer();this.connection.callReducer("set_approvals",s,this.setCallReducerFlags.setApprovalsFlags)}onSetApprovals(t){this.connection.onReducer("set_approvals",t)}removeOnSetApprovals(t){this.connection.offReducer("set_approvals",t)}unapprove(t,r){const n={voteId:t,optionId:r};let i=new X(1024);Xe.getTypeScriptAlgebraicType().serialize(i,n);let s=i.getBuffer();this.connection.callReducer("unapprove",s,this.setCallReducerFlags.unapproveFlags)}onUnapprove(t){this.connection.onReducer("unapprove",t)}removeOnUnapprove(t){this.connection.offReducer("unapprove",t)}}class cn{constructor(){this.approveFlags="FullUpdate",this.createVoteFlags="FullUpdate",this.deleteVoteFlags="FullUpdate",this.setApprovalsFlags="FullUpdate",this.unapproveFlags="FullUpdate"}approve(t){this.approveFlags=t}createVote(t){this.createVoteFlags=t}deleteVote(t){this.deleteVoteFlags=t}setApprovals(t){this.setApprovalsFlags=t}unapprove(t){this.unapproveFlags=t}}class ln{constructor(t){this.connection=t}get approval(){return new nn(this.connection.clientCache.getOrCreateTable(Ne.tables.approval))}get vote(){return new sn(this.connection.clientCache.getOrCreateTable(Ne.tables.vote))}get voteOption(){return new an(this.connection.clientCache.getOrCreateTable(Ne.tables.vote_option))}}class un extends Dr{}const Gt=class Gt extends Pr{constructor(){super(...arguments),this.subscriptionBuilder=()=>new un(this)}};Gt.builder=()=>new Ki(Ne,t=>t);let Jt=Gt;const ir=document.getElementById("status"),nr=document.getElementById("vote-list"),lt=document.getElementById("detail"),qe=document.getElementById("module-name"),Le=document.getElementById("server-uri"),sr=document.getElementById("create-form"),pn=document.getElementById("title"),ar=document.getElementById("options"),hn=document.getElementById("public");var fr;const qr=((fr=qe==null?void 0:qe.textContent)==null?void 0:fr.trim())||"zvote-proto1";var gr;const Lr=((gr=Le==null?void 0:Le.textContent)==null?void 0:gr.trim())||"ws://localhost:3000";let R=null,ae=null;function De(e){ir&&(ir.textContent=e)}function Pe(){if(R){nr.innerHTML="";for(const e of R.db.vote.iter()){const t=document.createElement("li"),r=document.createElement("div"),n=document.createElement("div");n.className="item-actions",r.innerHTML=`<strong>${dn(e.title)}</strong> <span class="badge">#${e.id.toString()}</span>`;const i=document.createElement("button");i.textContent="View",i.className="secondary",i.addEventListener("click",()=>{ae=e.id,fe()});const s=document.createElement("button");s.textContent="Delete",s.addEventListener("click",()=>{confirm(`Delete vote "${e.title}"?`)&&R.reducers.deleteVote(e.id)}),n.append(i,s),t.append(r,n),nr.appendChild(t)}}}function fe(){if(!R)return;if(ae==null){lt.textContent="Select a vote to view details.";return}const e=R.db.vote.id.find(ae);if(!e){lt.textContent=`Vote #${ae.toString()} not found.`;return}const t=[];for(const n of R.db.voteOption.iter())n.voteId===ae&&t.push(n);t.sort((n,i)=>i.approvalsCount!==n.approvalsCount?i.approvalsCount-n.approvalsCount:n.orderIndex-i.orderIndex);const r=[];r.push(`Title: ${e.title}`),r.push(`ID: ${e.id.toString()}`),r.push("Options:");for(const n of t)r.push(` • ${n.label} (${n.approvalsCount})`);lt.textContent=r.join(`
`)}function dn(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function fn(){sr&&sr.addEventListener("submit",e=>{if(e.preventDefault(),!R)return;const t=pn.value.trim(),r=!!hn.checked,n=ar.value.split(/\r?\n/).map(i=>i.trim()).filter(i=>i.length>0);if(!t){alert("Title is required");return}if(n.length===0){alert("Please enter at least one option (one per line).");return}R.reducers.createVote(t,n,r),ar.value=""})}function gn(){De("Connecting…");const e=localStorage.getItem("auth_token")||"",t=(i,s,c)=>{R=i,localStorage.setItem("auth_token",c),De("Connected"),R.subscriptionBuilder().onApplied(()=>{Pe(),fe()}).subscribe(["SELECT * FROM vote","SELECT * FROM vote_option"]),R.db.vote.onInsert(()=>Pe()),R.db.vote.onUpdate(()=>Pe()),R.db.vote.onDelete(()=>{ae!=null&&!R.db.vote.id.find(ae)&&(ae=null),Pe(),fe()}),R.db.voteOption.onInsert(()=>fe()),R.db.voteOption.onUpdate(()=>fe()),R.db.voteOption.onDelete(()=>fe())},r=()=>{De("Disconnected")},n=(i,s)=>{console.error("Error connecting to SpacetimeDB:",s),De("Error connecting")};Jt.builder().withUri(Lr).withModuleName(qr).withToken(e).onConnect(t).onDisconnect(r).onConnectError(n).build()}function yn(){qe.textContent=qr,Le.textContent=Lr,fn(),gn()}yn();
